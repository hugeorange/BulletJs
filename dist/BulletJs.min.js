!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("core-js/modules/es7.object.get-own-property-descriptors"),require("core-js/modules/es6.symbol"),require("core-js/modules/web.dom.iterable"),require("core-js/modules/es6.array.iterator"),require("core-js/modules/es6.object.to-string"),require("core-js/modules/es6.object.keys"),require("core-js/modules/es6.array.fill"),require("core-js/modules/es6.object.assign"),require("core-js/modules/es7.array.includes"),require("core-js/modules/es6.string.includes"),require("core-js/modules/es6.regexp.to-string")):"function"==typeof define&&define.amd?define(["core-js/modules/es7.object.get-own-property-descriptors","core-js/modules/es6.symbol","core-js/modules/web.dom.iterable","core-js/modules/es6.array.iterator","core-js/modules/es6.object.to-string","core-js/modules/es6.object.keys","core-js/modules/es6.array.fill","core-js/modules/es6.object.assign","core-js/modules/es7.array.includes","core-js/modules/es6.string.includes","core-js/modules/es6.regexp.to-string"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).BulletJs=e()}(this,(function(){"use strict";var t=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n};var e=function(e){if(Array.isArray(e))return t(e)};var r=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)};var n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}};var i=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var s=function(t){return e(t)||r(t)||n(t)||i()};var o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t};var u=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},c=function(t){var e=t.duration,r=document.createElement("div");return r.id=Math.random().toString(36).substring(2),r.classList.add("bullet-item-style"),r.style.animationDuration=e,r};function d(t,e,r,n){t.addEventListener(e,(function(e){for(var i=e.target;!i.className.includes(r);){if(i===t){i=null;break}i=i.parentNode}i&&n(i)}))}function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){u(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var g={trackHeight:50,pauseOnHover:!1,pauseOnClick:!1,onStart:null,onEnd:null,duration:"10s",speed:100};return function(){function t(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,t),u(this,"target",null),u(this,"tempContanier",null),u(this,"bulletInfo",{}),u(this,"bullets",[]),u(this,"tracks",[]),u(this,"queues",[]),u(this,"targetW",0),u(this,"pauseArrs",[]),u(this,"_render",(function(t,e){if(t.dataset.track=e,t.style.top=e*r.options.trackHeight+"px",r.target.appendChild(t),r.queues.length){var n=r.queues.shift();r.push(n.item,n.opts,!0)}})),u(this,"_toggleAnimateStatus",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"paused";t?"running"===e?(t.style.animationPlayState="running",t.style.zIndex=0,t.classList.remove("bullet-item-paused")):(t.style.animationPlayState="paused",t.style.zIndex=99999,t.classList.add("bullet-item-paused")):r.pauseArrs.length&&"paused"==e||(r.pauseArrs=r.getBulletsList(),r.pauseArrs.forEach((function(t){t.style.animationPlayState=e})),r.pauseArrs=[])})),this.options=Object.assign(g,n),this.ele=e,this.initScreen(),this.initOpt(),this.initTempContainer(),this._addExtraEvent()}return l(t,[{key:"initScreen",value:function(){if("string"==typeof this.ele){if(this.target=document.querySelector(this.ele),!this.target)throw new Error("The display target does not exist")}else{if(!(this.ele instanceof HTMLElement))throw new Error("The display target of the barrage must be set");this.target=this.ele}}},{key:"initOpt",value:function(){var t=this.options.trackHeight;this.targetPos=this.target.getBoundingClientRect();var e=Math.floor(this.targetPos.height/t);this.tracks=new Array(e).fill("idle"),this.bullets=new Array(e).fill([]),this.targetW=this.targetPos.width,"static"===getComputedStyle(this.target).position&&(this.target.style.position="relative",this.target.style.overflow="hidden"),function(t){var e=document.createElement("style");e.classList.add("BULLET_ANIMATE");var r="from { visibility: visible; transform: translateX(".concat(t,"px); }"),n="@keyframes RightToLeft { ".concat(r," ").concat("to { visibility: visible; transform: translateX(-100%); }"," }");e.innerHTML=n+"\n    .bullet-item-style {\n\t\tcursor: pointer;\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\tanimation-name: RightToLeft;\n\t\tanimation-timing-function: linear;\n\t\twill-change: transform;\n\t}\n\t\n\t.bullet-temp-container {\n\t\tposition: absolute;\n\t\tright: 9999px;\n\t\tvisibility: hidden;\n\t}\n\t",document.head.appendChild(e)}(this.targetW)}},{key:"initTempContainer",value:function(){this.tempContanier=document.createElement("div"),this.tempContanier.classList.add("bullet-temp-container"),document.body.appendChild(this.tempContanier)}},{key:"push",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Object.assign({},this.options,e),i=c(f(f({},n),{},{currScreen:this}));i.innerHTML=t,this.tempContanier.appendChild(i),this.bulletInfo={width:i.offsetWidth};var s=0;n.speed?(s=(this.targetW+this.bulletInfo.width)/n.speed,i.style.animationDuration=s+"s"):s=+n.duration.slice(0,-1),i.dataset.duration=s,this.bulletInfo.duration=s,i.remove();var o=this._getTrackIndex();return-1===o?r&&this.queues.push({item:t,opts:e}):(this.bullets[o].length?this.bullets[o].push(i):this.bullets[o]=[i],this._render(i,o),this._addEvent(i,o,n)),i.id}},{key:"_getTrackIndex",value:function(){var t,e,r=[],n=-1;if(this.tracks.forEach((function(t,e){return"idle"===t&&r.push(e)})),r.length){var i=(t=0,e=r.length-1,parseInt(Math.random()*(e-t+1))+t);return n=r[i],this.tracks[n]="running",n}for(var s=0;s<this.bullets.length;s++){var o=this.bullets[s].length;if(o){var a=this.bullets[s][o-1];if(a&&this._checkTrack(a))return s}}return n}},{key:"_checkTrack",value:function(t){var e=t.getBoundingClientRect();if(e.right>this.targetPos.right)return!1;if(this.options.speed){if(e.right<this.targetPos.right)return!0}else{var r=(this.targetW+e.width)/t.dataset.duration,n=(this.targetW+this.bulletInfo.width)/this.bulletInfo.duration;if(n<=r)return!0;var i=(e.right-this.targetPos.left)/r;if(this.targetW/n<i)return!1}return!0}},{key:"_addEvent",value:function(t,e,r){var n=this,i=r.onStart,s=r.onEnd;t.addEventListener("animationstart",(function(){i&&i.call(window,t.id,n)})),t.addEventListener("animationend",(function(){s&&s.call(window,t.id,n),n.bullets[e]=n.bullets[e].filter((function(e){return e.id!==t.id})),n.bullets[e].length||(n.tracks[e]="idle"),t.remove()}))}},{key:"_addExtraEvent",value:function(){var t=this;this.options.pauseOnClick&&d(this.target,"click","bullet-item-style",(function(e){console.log("el-click----\x3e",e),"paused"==e.style.animationPlayState&&e.dataset.clicked?(e.dataset.clicked="",t._toggleAnimateStatus(e,"running")):(e.dataset.clicked="true",t._toggleAnimateStatus(e,"paused"))})),this.options.pauseOnHover&&(d(this.target,"mouseover","bullet-item-style",(function(e){t._toggleAnimateStatus(e,"paused")})),d(this.target,"mouseout","bullet-item-style",(function(e){t._toggleAnimateStatus(e,"running")})))}},{key:"getBulletsList",value:function(){return this.bullets.reduce((function(t,e){return[].concat(s(e),s(t))}),[])}},{key:"pause",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._toggleAnimateStatus(t,"paused")}},{key:"resume",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._toggleAnimateStatus(t,"running")}}]),t}()}));
