<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>å¼¹å¹•æµ‹è¯•</title>
	<style>
		html, body {
			margin: 0;
			padding: 0;
		}
		.danmu-content {
			margin: 30px 10px;
			height: 180px;
			border: 1px solid;
		}

		.opeate button {
			margin: 10px;
			border: 1px solid;
		}
		.screen {
			/* width: 100vw; */
			height: 100%;
		}
		.danmu-item {
			margin: 5px;
			border: 1px solid;
			overflow: hidden;
			display: inline-block;
			word-break: keep-all; 
			white-space: nowrap;
		}
	</style>
</head>

<body>
	<div id="root">
		<div class="app">
			<div class="danmu-content">
				<div class="screen"></div>
				<div class="opeate">
					<button id="pauseAll">æš‚åœå…¨éƒ¨</button>
					<button id="continueAll">ç»§ç»­å…¨éƒ¨</button>
				</div>
				<div class="opeate">
					<button class="close-time">æš‚åœè®¡æ—¶å™¨</button>
					<button class="open-time" >ç»§ç»­è®¡æ—¶å™¨</button>
				</div>
				<div class="opeate">
					<input id="d-input" type="text" placeholder="æ‰‹åŠ¨å‘é€çš„å¼¹å¹•">
					<button id="sendDanmu" >å‘é€å¼¹å¹•</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="https://unpkg.com/js-bullets@0.0.3/dist/BulletJs.min.js"></script>
<script>
	const danmuList = [
		"ä½ å¥½ç§‘æ¯”å¸ƒè±æ©ç‰¹",
		"è¿™ä¸ªè€å“¥çš„è¯„è®ºè¯´çš„å¾ˆå¯¹å•Šï¼Œè¿™éƒ½èƒ½è¢«è¿è§„éšè—ï¼Ÿæ˜¯æˆ³ç—›åˆ°æŸäº›äººäº†å—ã€‚",
		"rip....",
		"resepct",
		"ğŸ˜‚â¤ï¸ğŸ˜ğŸ˜’ğŸ‘Œâ˜ºï¸â˜ºï¸ğŸ˜ŠğŸ˜­ğŸ˜©ğŸ˜©ğŸ˜”ğŸ˜ğŸ˜ğŸ‘ğŸ¿ğŸ˜ğŸ˜ğŸ˜ğŸ˜”ğŸ’•ğŸ˜­ğŸ˜˜ğŸ˜Šâ¤ï¸ğŸ˜",
		"åœ£ä½•å¡-ç©†é‡Œå°¼å¥¥",
		"æ³°ä¼¦å¢ï¼Œæ³°ä¼¦å¢ï¼Œæ³°ä¼¦å¢ï¼Œæ³°ä¼¦å¢",
		"å‹’å¸ƒæœ—-è©¹å§†æ–¯",
		"emoji",
		"æ¹–äººé˜µå®¹ä¹Ÿä¸æ˜¯ç‰¹åˆ«è±ªåä¸ºä»€ä¹ˆèƒ½æ‰“åˆ°è¥¿éƒ¨ç¬¬ä¸€ï¼Ÿ ç”±é«˜ç”°å¤§å” å‘è¡¨åœ¨ç¯®çƒÂ·æ¹¿ä¹ä¹çš„è¯é¢˜-è¯´çš„å¾ˆå¯¹å•Šï¼Œå¾ˆå¯¹å•Š",
		"----huhuh---hahahha---",
		"ğŸ˜‚â¤ï¸ğŸ˜ğŸ˜’ğŸ‘Œâ˜ºï¸â˜ºï¸ğŸ˜ŠğŸ˜­ğŸ˜©ğŸ˜©ğŸ˜”ğŸ˜ğŸ˜ğŸ‘ğŸ¿ğŸ˜ğŸ˜ğŸ˜ğŸ˜”ğŸ’•ğŸ˜­ğŸ˜˜ğŸ˜Šâ¤ï¸ğŸ˜"
	]

	const getRandom = (min, max) => parseInt(Math.random() * (max - min + 1)) + min

	const danmuTest = {
		screen: null,
		handler: null,
		dom: {
			closeTime: document.querySelector('.close-time'),
			openTime: document.querySelector('.open-time'),
			sendDanmu: document.querySelector('#sendDanmu'),
			dInput: document.querySelector('#d-input'),
			pauseAll: document.querySelector('#pauseAll'),
			continueAll: document.querySelector('#continueAll'),
		},
		init() {
			this.eventInit();
			this.screen = new BulletJs('.screen', {
				trackHeight: 35,
				// speed: 80,
				pauseOnClick: true,
				pauseOnHover: false,
				// duration: '10s'
			});
			this.sendDanmu();
		},
		sendDanmu() {
			this.sendAction();
		},
		sendAction () {
			this.handler = setInterval(() => {
				const index = getRandom(0, 10);
				const str = danmuList[index];
				const dom = `<span class="danmu-item">${str}</span>`
				this.screen.push(dom)
			}, 500);
		},
		// æš‚åœ
		pause() {
			this.screen.pause()
		},
		// ç»§ç»­
		continue() {
			this.screen.resume()
		},
		closeTime() {
			this.handler && clearInterval(this.handler)
		},
		eventInit() {
			this.dom.closeTime.addEventListener('click', () => {
				this.closeTime()
			})
			this.dom.openTime.addEventListener('click', () => {
				this.sendDanmu()
			})

			this.dom.sendDanmu.addEventListener('click', () => {
				const value = this.dom.dInput.value;
				if (value) {
					const danmu = `<span class="danmu-item" style="color: red;">${value}</span>`
					this.screen.push(danmu, {
						onStart: (id, danmu) => {
							console.log('å®ä¾‹çš„æ–¹æ³•onStart----->', 'id------->', id, 'danmu-------->', danmu)
						},
						onEnd: (id, danmu) => {
							console.log('å®ä¾‹çš„æ–¹æ³•onEnd----->', 'id------->', id, 'danmu-------->', danmu)
						}
					}, true)
				} else {
					alert("è¯·è¾“å…¥è¦å‘é€çš„å¼¹å¹•")
				}
			})
		
			this.dom.pauseAll.addEventListener('click', () => {
				this.pause();
			})

			this.dom.continueAll.addEventListener('click', () => {
				this.continue();
			})
		}
	}

	danmuTest.init()
</script>

</html>